function qp_load_template_options(e){var t=$("#page-id"),o=1==t.length?$(t).val():0,a={id:o,file:e,CUTOKEN_REQUEST:$("#cu-token").val(),action:"load-panel"};$.post("pages.php",a,function(e){return 1==e.error?void 0==e.token?void window.location.reload():(show_alert_options(e.message,"danger"),void $("#cu-token").val(e.token)):(void 0!=e.token&&$("#cu-token").val(e.token),void $("#qp-page-options").html(e.form).slideDown(250))},"json")}function show_alert_options(e,t){if(void 0!=e&&""!=e){t=void 0==t||""==t?"info":t;var o='<div class="alert alert-'+t+'">'+e+"</div>";$("#qp-page-options").html(o),window.location.href="#qp-page-options"}}function qp_verify_fields(){if(""==$("#qp-title").val())return $("#qp-blocker-info span").html(qpLang.notitle).addClass("qp-error"),$("#qp-blocker-info button:last-child").fadeIn("fast"),void $("#qp-blocker-info button.btn-info").fadeOut("fast");if("redir"==$("#page-type").val()&&""==$("input[name='url']").val())return $("#qp-blocker-info span").html(qpLang.nourl).addClass("qp-error"),$("#qp-blocker-info button:last-child").fadeIn("fast"),void $("#qp-blocker-info button.btn-info").fadeOut("fast");"undefined"!=typeof tinymce?tinymce.activeEditor.save():"undefined"!=typeof mdEditor&&mdEditor.save("content");var e=$("#frm-page").serialize();e+="&"+$("#frm-basic-options").serialize(),e+="&"+$("#frm-view").serialize(),e+="&"+$("#frm-defimage").serialize(),e+="&"+$("#frm-page-template").serialize(),$("#qp-blocker-info span").html(qpLang.saving).removeClass("qp-error"),$.post("pages.php",e,function(e){return e.error>0?(qp_show_message(e.message,1),""!=e.token?$("#XOOPS_TOKEN_REQUEST").val(e.token):window.location.href=window.location.href,!1):(qp_show_message(e.message,0),$("#qp-blocker-info").addClass("blocker-success"),$("#qp-blocker-info button:last-child").html(qpLang.done),""!=e.token&&$("#XOOPS_TOKEN_REQUEST").val(e.token),$("#qp-permalink span").html(e.data.permalink),$("#qp-custom-url").length>0&&$("#qp-custom-url input").val(e.data.custom_url),void(void 0!=e.data.redirect&&(window.location.href=e.data.redirect)))},"json")}function qp_show_message(e,t){t>0?($("#qp-blocker-info span").html(e).addClass("qp-error"),$("#qp-blocker-info button:last-child").fadeIn("fast"),$("#qp-blocker-info button.btn-info").fadeOut("fast")):($("#qp-blocker-info span").html(e).removeClass("qp-error"),$("#qp-blocker-info button:last-child").fadeIn("fast").removeClass("btn-danger").addClass("btn-success"),$("#qp-blocker-info button.btn-info").fadeOut("fast")),setTimeout("qp_close_msg()",15e3)}function qp_close_msg(){$("#qp-blocker-info").fadeOut("fast",function(){$("#qp-blocker").fadeOut("fast",function(){$("#qp-blocker-info").remove(),$("#qp-blocker").remove()})})}$(document).ready(function(){$("a#add-field-name").click(function(){"Add New"==$(this).text()?($("#dmeta-sel").hide(),$("#dmeta").show(),$(this).text("Cancel")):($("#dmeta-sel").show(),$("#dmeta").hide(),$(this).text("Add New"))}),$("#add-field").click(function(){if(""!=$("#dvalue").val()){$("#dmeta-sel").is(":visible")?name=$("#dmeta-sel").val():$("#dmeta-sel").length>0?(name=$("#dmeta").val(),$("#dmeta-sel").show(),$("#dmeta").hide(),$("#dmeta").val(""),$(this).text("Add New")):(name=$("#dmeta").val(),$("#dmeta").val(""),$(this).text("Add New"));var e='<div class="row"><div class="col-sm-4"><div class="form-group"><input type="text" class="form-control" name="meta_name[]" value="'+name+'" /><br><button type="button" class="btn btn-warning btn-sm delete-meta">Delete</button></div></div>';e+='<div class="col-sm-8"><div class="form-group"><textarea class="form-control" name="meta_value[]">'+$("#dvalue").val()+"</textarea></div></div></div>",$("#dvalue").val(""),$("#existing-meta > .row:first-child").after(e)}}),$("#existing-meta").on("click",".delete-meta",function(){$(this).parent().parent().remove()}),$("#page-type").change(function(){var e=$(this).val();switch(e){case"":$("#ed-cont-content").fadeIn("fast"),$(".no-normal").fadeOut("fast"),$(".yes-normal").fadeIn("fast");break;case"redir":$("#ed-cont-content").fadeOut("fast"),$(".no-redir").fadeOut("fast"),$(".yes-redir").fadeIn("fast")}}),$("button.qp-submit").click(function(){var e='<div id="qp-blocker"></div><div id="qp-blocker-info"><span>'+qpLang.check+'</span><button type="button" class="btn btn-info">'+qpLang.cancel+"</button>";e+='<button class="btn btn-danger">'+qpLang.ok+"</button></div>",$("body").append(e),$("#qp-blocker").fadeIn("fast",function(){$("#qp-blocker-info").fadeIn("fast"),qp_verify_fields()}),$("#qp-blocker-info button").click(function(){$("#qp-blocker-info").fadeOut("fast",function(){$("#qp-blocker").fadeOut("fast",function(){$("#qp-blocker-info").remove(),$("#qp-blocker").remove()})})})}),$("#custom-tpl").change(function(){return""==$(this).val()?void $("#qp-page-options").slideUp(250):void qp_load_template_options($(this).val())})});
